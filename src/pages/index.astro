---
import MuseumLayout from '../layouts/MuseumLayout.astro';
import ExhibitCard from '../components/ExhibitCard.astro';
import fs from 'node:fs';
import path from 'node:path';
import matter from 'gray-matter';

// Fetch data from local ./data directory
const dataDir = path.join(process.cwd(), 'data');
let posts = [];

try {
    const filenames = fs.readdirSync(dataDir).filter(file => file.endsWith('.md'));
    
    posts = filenames.map(filename => {
        const filePath = path.join(dataDir, filename);
        const fileContent = fs.readFileSync(filePath, 'utf-8');
        const { data } = matter(fileContent);
        
        return {
            slug: filename.replace('.md', ''),
            frontmatter: data
        };
    });
} catch (e) {
    console.error("Could not read data directory:", e);
    // Fallback for demo if directory is missing
    posts = [];
}
---

<MuseumLayout title="The Grand Gallery">
	<section class="max-w-2xl mx-auto text-center mb-20 animate-fade-in">
		<h2 class="font-display text-4xl md:text-5xl text-museum-gold mb-6 drop-shadow-lg">
			The Grand Gallery
		</h2>
		<p class="font-body text-xl text-museum-paper/80 italic leading-relaxed">
			"Knowledge, like art, belongs to the world. Wander through these halls and discover the fragments of wisdom we have preserved."
		</p>
	</section>

	<div class="grid grid-cols-1 md:grid-cols-2 gap-12 md:gap-16">
        {posts.map((post) => (
            <ExhibitCard 
                title={post.frontmatter.title || "Untitled Fragment"} 
                author={post.frontmatter.author} 
                date={post.frontmatter.date}
                url={`/posts/${post.slug}`}
                description={post.frontmatter.description || post.frontmatter.excerpt}
                image={post.frontmatter.cover || post.frontmatter.image}
            />
        ))}
        
        {posts.length === 0 && (
            <div class="col-span-full text-center py-20 border border-museum-gold/30 rounded bg-museum-bg/50">
                <p class="font-display text-museum-gold text-xl">The archives are currently empty.</p>
                <p class="font-body text-museum-paper/60 mt-2">Please decorate the ./data directory with markdown artifacts.</p>
            </div>
        )}
	</div>
</MuseumLayout>
